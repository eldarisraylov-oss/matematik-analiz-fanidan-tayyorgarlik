<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Test — Matematik analiz (demo)</title>

  <!-- MathJax for formulas -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <style>
    body{font-family:Arial, sans-serif; background:#f6f7fb; margin:0; padding:16px;}
    .wrap{max-width:900px; margin:0 auto;}
    .top{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    select, button{padding:10px 12px; border-radius:10px; border:1px solid #d6d8e5; background:#fff;}
    button{cursor:pointer;}
    .card{margin-top:14px; background:#fff; border:1px solid #e6e7f2; border-radius:16px; padding:16px;}
    .qno{font-weight:700; opacity:.8;}
    .qtext{margin-top:8px; font-size:18px; line-height:1.45;}
    .opts{display:grid; gap:10px; margin-top:14px;}
    .opt{padding:12px 12px; border:1px solid #e6e7f2; border-radius:14px; background:#fafbff; cursor:pointer; text-align:left;}
    .opt:hover{background:#f1f3ff;}
    .opt.correct{border-color:#2ecc71; background:#eafff2;}
    .opt.wrong{border-color:#ff4d4f; background:#fff0f0;}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;}
    .muted{opacity:.7;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div style="font-weight:800; font-size:20px;">Matematik analiz — demo</div>
        <div class="muted">4 ta bo‘lim (50 tadan)</div>
      </div>

      <div class="row">
        <select id="sectionSelect">
          <option value="bolim_1-50">1–50</option>
          <option value="bolim_51-100">51–100</option>
          <option value="bolim_101-150">101–150</option>
          <option value="bolim_151-200">151–200</option>
        </select>
        <button id="loadBtn">Bo‘limni yuklash</button>
      </div>
    </div>

    <div class="card" id="card" style="display:none;">
      <div class="qno" id="qno"></div>
      <div class="qtext" id="qtext"></div>
      <div class="opts" id="opts"></div>

      <div class="row">
        <button id="prevBtn">⬅️ Oldingi</button>
        <button id="nextBtn">Keyingi ➡️</button>
        <div class="muted" id="progress"></div>
      </div>
    </div>

    <div class="card" id="hint">
      <div style="font-weight:700;">Qanday tekshirasan?</div>
      <div class="muted" style="margin-top:6px;">
        1) Bo‘lim tanla → “Bo‘limni yuklash”<br/>
        2) Variantni bos → to‘g‘ri/yolg‘on ko‘rinadi<br/>
        3) Keyingi/Oldingi bilan yurib ko‘r
      </div>
    </div>
  </div>

  <script>
    const sectionFiles = {
      "bolim_1-50": "bolim_1-50.js",
      "bolim_51-100": "bolim_51-100.js",
      "bolim_101-150": "bolim_101-150.js",
      "bolim_151-200": "bolim_151-200.js",
    };

    let currentSection = null;
    let idx = 0;

    function loadScript(src){
      return new Promise((resolve, reject)=>{
        const s=document.createElement("script");
        s.src=src;
        s.onload=()=>resolve();
        s.onerror=()=>reject(new Error("Script yuklanmadi: "+src));
        document.body.appendChild(s);
      });
    }

    function render(){
      const q = currentSection.questions[idx];
      document.getElementById("card").style.display = "block";
      document.getElementById("hint").style.display = "none";

      document.getElementById("qno").textContent = `Savol №${q.n}`;
      document.getElementById("qtext").innerHTML = q.q;

      const opts = document.getElementById("opts");
      opts.innerHTML = "";

      q.options.forEach((t,i)=>{
        const b=document.createElement("button");
        b.className="opt";
        b.type="button";
        b.innerHTML = t;

        b.onclick=()=>{
          [...opts.children].forEach(x=>x.disabled=true);
          if(i===q.correctIndex){
            b.classList.add("correct");
          }else{
            b.classList.add("wrong");
            opts.children[q.correctIndex]?.classList.add("correct");
          }
        };

        opts.appendChild(b);
      });

      document.getElementById("progress").textContent = `${idx+1}/${currentSection.questions.length}`;

      if(window.MathJax) MathJax.typesetPromise();
    }

    async function loadSection(){
      const key = document.getElementById("sectionSelect").value;
      const file = sectionFiles[key];

      // clear previous global
      window.QUESTION_SECTION = null;

      await loadScript(file);

      currentSection = window.QUESTION_SECTION;
      idx = 0;
      render();
    }

    document.getElementById("loadBtn").onclick = loadSection;
    document.getElementById("prevBtn").onclick = ()=>{ if(!currentSection) return; idx=Math.max(0, idx-1); render(); };
    document.getElementById("nextBtn").onclick = ()=>{ if(!currentSection) return; idx=Math.min(currentSection.questions.length-1, idx+1); render(); };

  </script>
</body>
</html>
